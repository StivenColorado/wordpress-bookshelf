(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var a in l)e.o(l,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:l[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t);const l=window.React,a=window.wp.element,n=window.wp.apiFetch;var r=e.n(n);const o=window.wp.i18n,s=window.wp.components,i=window.wp.primitives,c=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{d:"M12 4 4 19h16L12 4zm0 3.2 5.5 10.3H12V7.2z"})),m=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})),u=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})),d=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})),p=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{d:"M14.6 7l-1.2-1L8 12l5.4 6 1.2-1-4.6-5z"})),E=(0,l.createElement)(i.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,l.createElement)(i.Path,{d:"M10.6 6L9.4 7l4.6 5-4.6 5 1.2 1 5.4-6z"}));function _({view:e="list",context:n="frontend"}){const[i,_]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[h,y]=(0,a.useState)(!0),[x,v]=(0,a.useState)(""),[f,w]=(0,a.useState)(""),[C,k]=(0,a.useState)(1),[S,F]=(0,a.useState)(1),[B,A]=(0,a.useState)(0),[I]=(0,a.useState)(10),[T,N]=(0,a.useState)(""),[L,O]=(0,a.useState)(""),[P,D]=(0,a.useState)(""),[V,H]=(0,a.useState)(""),[j,z]=(0,a.useState)("date"),[M,R]=(0,a.useState)("DESC"),[G,q]=(0,a.useState)(!1),[Z,$]=(0,a.useState)(!1),[W,Y]=(0,a.useState)(null),[U,X]=(0,a.useState)(null),[J,K]=(0,a.useState)({title:"",content:"",author:"",published_year:"",isbn:"",pages:"",genres:[]}),[Q,ee]=(0,a.useState)(null),[te,le]=(0,a.useState)(!1);(0,a.useEffect)(()=>{ne(),ae(),"admin"===n&&re()},[]),(0,a.useEffect)(()=>{ae()},[C,T,L,P,V,j,M]);const ae=async()=>{y(!0);try{const e=new URLSearchParams({per_page:I,page:C,orderby:j,order:M});T&&e.append("search",T),L&&e.append("genre",L),P&&e.append("author",P),V&&e.append("year",V);const t=await r()({path:`/bookshelf/v1/books?${e}`,parse:!1}),l=await t.json(),a=parseInt(t.headers.get("X-WP-Total")||"0"),n=parseInt(t.headers.get("X-WP-TotalPages")||"1");_(l),A(a),F(n)}catch(e){v((0,o.__)("Error al cargar los libros: ")+e.message)}y(!1)},ne=async()=>{try{const e=await r()({path:"/bookshelf/v1/genres"});b(e)}catch(e){console.error("Error loading genres:",e)}},re=async()=>{try{const e=await r()({path:"/bookshelf/v1/stats"});ee(e)}catch(e){console.error("Error loading stats:",e)}},oe=()=>{K({title:"",content:"",author:"",published_year:"",isbn:"",pages:"",genres:[]}),X(null)},se=(e=null)=>{e?(X(e),K({title:e.title||"",content:e.content||"",author:e.author||"",published_year:e.published_year||"",isbn:e.isbn||"",pages:e.pages||"",genres:e.genres?e.genres.map(e=>e.id):[]})):oe(),v(""),w(""),q(!0)},ie=()=>{q(!1),setTimeout(()=>{oe()},100)},ce=()=>{$(!1),Y(null)},me=[...new Set(i.map(e=>e.author).filter(Boolean))],ue=[...new Set(i.map(e=>e.published_year).filter(Boolean))].sort((e,t)=>t-e);return(0,l.createElement)("div",{className:"bookshelf-app"},x&&(0,l.createElement)(s.Notice,{status:"error",onRemove:()=>v("")},x),f&&(0,l.createElement)(s.Notice,{status:"success",onRemove:()=>w("")},f),"admin"===n&&(0,l.createElement)(s.Card,{className:"bookshelf-admin-toolbar"},(0,l.createElement)(s.CardBody,null,(0,l.createElement)(s.Flex,{justify:"space-between"},(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.Button,{variant:"primary",icon:m,onClick:()=>se()},(0,o.__)("Añadir libro"))),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.Button,{variant:"secondary",icon:t.book,onClick:()=>le(!te)},te?(0,o.__)("Ocultar Estadísticas"):(0,o.__)("Ver Estadísticas")))))),"admin"===n&&te&&(Q&&te?(0,l.createElement)(s.Card,{className:"bookshelf-stats"},(0,l.createElement)(s.CardHeader,null,(0,l.createElement)("h3",null,(0,o.__)("Estadísticas"))),(0,l.createElement)(s.CardBody,null,(0,l.createElement)(s.Flex,{gap:4,wrap:!0},(0,l.createElement)(s.FlexItem,null,(0,l.createElement)("div",{className:"stat-item"},(0,l.createElement)("h4",null,Q.total_books),(0,l.createElement)("p",null,(0,o.__)("Total de Libros")))),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)("div",{className:"stat-item"},(0,l.createElement)("h4",null,Q.total_genres),(0,l.createElement)("p",null,(0,o.__)("Total de Géneros")))),Q.books_by_year&&Object.keys(Q.books_by_year).length>0&&(0,l.createElement)(s.FlexItem,{style:{flexBasis:"100%",marginTop:"20px"}},(0,l.createElement)("h4",null,(0,o.__)("Libros por año")),(0,l.createElement)("div",{style:{maxHeight:"200px",overflowY:"auto"}},(0,l.createElement)("ul",null,Object.entries(Q.books_by_year).sort((e,t)=>t[0]-e[0]).map(([e,t])=>(0,l.createElement)("li",{key:e,style:{marginBottom:"8px"}},(0,l.createElement)("strong",null,e,":")," ",t," ",(0,o.__)("libros")))))),Q.top_authors&&Object.keys(Q.top_authors).length>0&&(0,l.createElement)(s.FlexItem,{style:{flexBasis:"100%",marginTop:"20px"}},(0,l.createElement)("h4",null,(0,o.__)("Autores más prolíficos")),(0,l.createElement)("div",{style:{maxHeight:"200px",overflowY:"auto"}},(0,l.createElement)("ul",null,Object.entries(Q.top_authors).map(([e,t])=>(0,l.createElement)("li",{key:e,style:{marginBottom:"8px"}},(0,l.createElement)("strong",null,e,":")," ",t," ",(0,o.__)("libros"))))))))):null),"list"===e&&(0,l.createElement)(l.Fragment,null,(0,l.createElement)(s.Card,{className:"bookshelf-filters"},(0,l.createElement)(s.CardHeader,null,(0,l.createElement)("h3",null,(0,o.__)("Filtros y Búsqueda"))),(0,l.createElement)(s.CardBody,null,(0,l.createElement)(s.Flex,{gap:3,wrap:!0},(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.SearchControl,{value:T,onChange:e=>{N(e),k(1)},placeholder:(0,o.__)("Buscar libros...")})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.SelectControl,{label:(0,o.__)("Género"),value:L,onChange:O,options:[{label:(0,o.__)("Todos los géneros"),value:""},...g.map(e=>({label:e.name,value:e.slug}))]})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.SelectControl,{label:(0,o.__)("Autor"),value:P,onChange:D,options:[{label:(0,o.__)("Todos los autores"),value:""},...me.map(e=>({label:e,value:e}))]})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.SelectControl,{label:(0,o.__)("Año"),value:V,onChange:H,options:[{label:(0,o.__)("Todos los años"),value:""},...ue.map(e=>({label:e.toString(),value:e.toString()}))]})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.SelectControl,{label:(0,o.__)("Ordenar por"),value:j,onChange:z,options:[{label:(0,o.__)("Fecha"),value:"date"},{label:(0,o.__)("Título"),value:"title"},{label:(0,o.__)("Autor"),value:"author"},{label:(0,o.__)("Año"),value:"year"}]})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.SelectControl,{label:(0,o.__)("Orden"),value:M,onChange:R,options:[{label:(0,o.__)("Descendente"),value:"DESC"},{label:(0,o.__)("Ascendente"),value:"ASC"}]})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.Button,{variant:"secondary",onClick:()=>{N(""),O(""),D(""),H(""),k(1)},icon:c},(0,o.__)("Limpiar filtros"))),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.Button,{variant:"primary",onClick:()=>se(),icon:m},(0,o.__)("Nuevo Libro")))))),h?(0,l.createElement)("div",{style:{textAlign:"center",padding:"40px"}},(0,l.createElement)(s.Spinner,null),(0,l.createElement)("p",{style:{marginTop:"10px"}},(0,o.__)("Cargando libros..."))):0===i.length?(0,l.createElement)(s.Card,null,(0,l.createElement)(s.CardBody,null,(0,l.createElement)("p",{style:{textAlign:"center",padding:"20px"}},(0,o.__)("No se encontraron libros")))):(0,l.createElement)(l.Fragment,null,(0,l.createElement)("div",{className:"bookshelf-book-grid",style:{marginTop:"20px"}},i.map(e=>(0,l.createElement)(s.Card,{key:e.id,className:"bookshelf-book-card"},(0,l.createElement)(s.CardBody,null,(0,l.createElement)(s.Flex,null,(0,l.createElement)(s.FlexItem,null,e.featured_image&&(0,l.createElement)("img",{src:e.featured_image,alt:e.title,style:{width:"80px",height:"120px",objectFit:"cover"}})),(0,l.createElement)(s.FlexBlock,null,(0,l.createElement)("h3",null,e.title),(0,l.createElement)("p",null,(0,l.createElement)("strong",null,(0,o.__)("Autor:"))," ",e.author),e.published_year&&(0,l.createElement)("p",null,(0,l.createElement)("strong",null,(0,o.__)("Año:"))," ",e.published_year),e.pages&&(0,l.createElement)("p",null,(0,l.createElement)("strong",null,(0,o.__)("Páginas:"))," ",e.pages),e.genres&&e.genres.length>0&&(0,l.createElement)("p",null,(0,l.createElement)("strong",null,(0,o.__)("Géneros:"))," ",e.genres.map(e=>(0,l.createElement)("span",{key:e.id,className:"bookshelf-genre-tag",style:{backgroundColor:e.color||"#ddd",color:"#fff",padding:"2px 8px",borderRadius:"12px",fontSize:"12px",marginRight:"4px"}},e.name))),e.content&&(0,l.createElement)("p",{className:"bookshelf-excerpt"},e.content.substring(0,150),"...")),(window.bookshelfData?.canEdit||window.bookshelfData?.canDelete)&&(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.Flex,{direction:"column",gap:2},window.bookshelfData?.canEdit&&(0,l.createElement)(s.Button,{variant:"secondary",size:"small",icon:u,onClick:()=>se(e)},(0,o.__)("Editar")),window.bookshelfData?.canDelete&&(0,l.createElement)(s.Button,{variant:"secondary",size:"small",icon:d,isDestructive:!0,onClick:()=>(e=>{Y(e),$(!0)})(e)},(0,o.__)("Eliminar"))))))))),S<=1?null:(0,l.createElement)(s.Flex,{justify:"center",className:"bookshelf-pagination"},(0,l.createElement)(s.Button,{variant:"secondary",icon:p,disabled:1===C,onClick:()=>k(C-1)},(0,o.__)("Anterior")),(0,l.createElement)("span",{style:{margin:"0 16px",alignSelf:"center"}},(0,o.__)("Página")," ",C," ",(0,o.__)("de")," ",S),(0,l.createElement)(s.Button,{variant:"secondary",icon:E,disabled:C===S,onClick:()=>k(C+1)},(0,o.__)("Siguiente"))))),G&&(0,l.createElement)(s.Modal,{title:U?(0,o.__)("Editar Libro"):(0,o.__)("Añadir Nuevo Libro"),onRequestClose:ie,isOpen:G,className:"bookshelf-modal",shouldCloseOnClickOutside:!1},(0,l.createElement)("form",{onSubmit:async e=>{if(e.preventDefault(),J.title.trim()&&J.author.trim()){y(!0);try{const e=U?"PUT":"POST",t=U?`/bookshelf/v1/books/${U.id}`:"/bookshelf/v1/books";await r()({path:t,method:e,data:J}),w(U?(0,o.__)("Libro actualizado correctamente"):(0,o.__)("Libro creado correctamente")),ie(),ae(),"admin"===n&&re()}catch(e){v((0,o.__)("Error al guardar: ")+e.message)}y(!1)}else v((0,o.__)("El título y el autor son obligatorios"))}},(0,l.createElement)(s.TextControl,{label:(0,o.__)("Título *"),value:J.title,onChange:e=>K({...J,title:e}),required:!0}),(0,l.createElement)(s.TextareaControl,{label:(0,o.__)("Descripción"),value:J.content,onChange:e=>K({...J,content:e}),rows:4}),(0,l.createElement)(s.TextControl,{label:(0,o.__)("Autor *"),value:J.author,onChange:e=>K({...J,author:e}),required:!0}),(0,l.createElement)(s.Flex,{gap:4},(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.__experimentalNumberControl,{label:(0,o.__)("Año de publicación"),value:J.published_year||"",onChange:e=>K({...J,published_year:e?parseInt(e):""}),min:1e3,max:(new Date).getFullYear()})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.TextControl,{label:(0,o.__)("ISBN"),value:J.isbn||"",onChange:e=>K({...J,isbn:e})})),(0,l.createElement)(s.FlexItem,null,(0,l.createElement)(s.__experimentalNumberControl,{label:(0,o.__)("Número de páginas"),value:J.pages||"",onChange:e=>K({...J,pages:e?parseInt(e):""}),min:1}))),g.length>0&&(0,l.createElement)("div",{className:"bookshelf-genre-selector",style:{margin:"20px 0"}},(0,l.createElement)("label",{style:{fontWeight:"bold",marginBottom:"10px",display:"block"}},(0,o.__)("Géneros")),(0,l.createElement)("div",{className:"genre-checkboxes",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(150px, 1fr))",gap:"8px"}},g.map(e=>(0,l.createElement)("div",{key:e.id,style:{display:"flex",alignItems:"center"}},(0,l.createElement)("input",{type:"checkbox",id:`genre-${e.id}`,checked:J.genres.includes(e.id),onChange:t=>{const l=t.target.checked?[...J.genres,e.id]:J.genres.filter(t=>t!==e.id);K({...J,genres:l})},style:{marginRight:"8px"}}),(0,l.createElement)("label",{htmlFor:`genre-${e.id}`,style:{padding:"4px 8px",borderRadius:"12px",backgroundColor:e.color||"#ddd",color:"#fff",fontSize:"12px",cursor:"pointer"}},e.name))))),(0,l.createElement)(s.Flex,{justify:"flex-end",gap:2,style:{marginTop:"30px"}},(0,l.createElement)(s.Button,{variant:"secondary",onClick:ie,disabled:h},(0,o.__)("Cancelar")),(0,l.createElement)(s.Button,{variant:"primary",type:"submit",disabled:h},h?(0,l.createElement)(s.Spinner,null):U?(0,o.__)("Actualizar Libro"):(0,o.__)("Crear Libro"))))),Z&&(0,l.createElement)(s.Modal,{title:(0,o.__)("Confirmar eliminación"),onRequestClose:ce,isOpen:Z,className:"bookshelf-delete-modal"},(0,l.createElement)("div",{style:{padding:"20px 0"}},(0,l.createElement)("p",null,(0,o.__)("¿Estás seguro de que quieres eliminar el libro"),(0,l.createElement)("strong",null,' "',W?.title,'"'),"?"),(0,l.createElement)("p",{style:{color:"#d63384",fontSize:"14px"}},(0,o.__)("Esta acción no se puede deshacer."))),(0,l.createElement)(s.Flex,{justify:"flex-end",gap:2},(0,l.createElement)(s.Button,{variant:"secondary",onClick:ce,disabled:h},(0,o.__)("Cancelar")),(0,l.createElement)(s.Button,{variant:"primary",isDestructive:!0,onClick:async()=>{if(W){y(!0);try{await r()({path:`/bookshelf/v1/books/${W.id}`,method:"DELETE"}),w((0,o.__)("Libro eliminado correctamente")),ce(),ae(),"admin"===n&&re()}catch(e){v((0,o.__)("Error al eliminar: ")+e.message)}y(!1)}},disabled:h},h?(0,l.createElement)(s.Spinner,null):(0,o.__)("Eliminar")))))}function g(){const e=document.getElementById("bookshelf-root");if(e){const t=e.getAttribute("data-view")||"list",n=e.getAttribute("data-context")||"frontend";(0,a.render)((0,l.createElement)(_,{view:t,context:n}),e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g(),window.addEventListener("load",()=>{document.querySelectorAll("#bookshelf-root:not([data-initialized])").forEach(e=>{e.setAttribute("data-initialized","true");const t=e.getAttribute("data-view")||"list",n=e.getAttribute("data-context")||"frontend";(0,a.render)((0,l.createElement)(_,{view:t,context:n}),e)})})})();